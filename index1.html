<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IOE NATIVE - OUTPUT STREAM</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&family=Audiowide&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <style>
    :root { 
        --neon: #00ff88; 
        --bg: #0a0a0a; 
        --panel-bg: rgba(10, 10, 10, 0.9);
        --border: #00ff8844;
        --text-dim: #555;
    }

    * { box-sizing: border-box; font-family: 'JetBrains Mono', monospace; }
    body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: #00ff88; overflow: hidden; }
    
    #particles-js { position: absolute; width: 100%; height: 100%; z-index: 1; }

    .main-layout {
      position: relative; z-index: 2; display: flex; 
      justify-content: center; align-items: flex-start; 
      height: 100vh; gap: 20px; padding: 40px;
    }

    /* Side Panel: Configuration */
    .config-panel {
      width: 350px;
      background: var(--panel-bg);
      border: 1px solid var(--border);
    }

    .panel-header {
      padding: 10px 15px;
      border-bottom: 1px solid var(--border);
      font-size: 12px;
      color: var(--text-dim);
      display: flex; align-items: center; gap: 10px;
    }

    .input-section { padding: 20px; }
    .input-label { font-size: 11px; color: var(--text-dim); margin-bottom: 8px; display: block; }
    .input-label i { color: var(--neon); margin-right: 5px; }

    .input-field {
      background: #000;
      border: 1px solid #222;
      padding: 12px;
      display: flex; align-items: center;
      margin-bottom: 20px;
    }
    input {
      background: transparent; border: none; color: #fff; width: 100%;
      outline: none; font-size: 13px;
    }

    .btn-run {
      width: 100%; padding: 15px;
      background: transparent; border: 1px solid var(--neon);
      color: var(--neon); font-weight: 800; cursor: pointer;
      text-transform: uppercase; transition: 0.3s;
      margin-bottom: 10px;
    }
    .btn-run:hover { background: var(--neon); color: #000; box-shadow: 0 0 15px var(--neon); }
    
    .btn-skill {
        width: 100%; padding: 12px;
        background: #111; border: 1px solid #222;
        color: var(--text-dim); cursor: default;
        font-size: 12px; text-transform: uppercase;
    }

    /* Main Panel: Output Stream */
    .output-panel {
      width: 650px; height: 80vh;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      display: flex; flex-direction: column;
    }

    .output-content {
      flex: 1; padding: 20px;
      overflow-y: auto; font-size: 13px;
      background: rgba(0, 0, 0, 0.5);
    }

    .log-line { margin-bottom: 12px; display: flex; gap: 15px; }
    .timestamp { color: var(--text-dim); min-width: 80px; }
    .status-tag { min-width: 40px; font-weight: 800; }
    .msg-blue { color: #44aaff; }
    .msg-green { color: var(--neon); }
    .msg-white { color: #fff; }
    .msg-red { color: #ff4444; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: var(--neon); }

    .ready-dot {
        display: inline-block; width: 8px; height: 8px;
        background: var(--neon); border-radius: 50%;
        margin-right: 10px; box-shadow: 0 0 10px var(--neon);
    }
  </style>
</head>
<body>

<div id="particles-js"></div>

<div class="main-layout">
  <div class="config-panel">
    <div class="panel-header">// CONFIGURATION</div>
    <div class="input-section">
      <span class="input-label">$ TARGET URL</span>
      <div class="input-field">
        <input type="text" id="target-url" placeholder="https://ioe.vn/...">
      </div>

      <span class="input-label">$ DELAY</span>
      <div class="input-field">
        <input type="number" id="delay" value="10">
      </div>

      <button class="btn-run" onclick="startEngine()">RUN</button>
      <button class="btn-skill">SKILL ISSUE</button>
      
      <div style="margin-top: 20px; font-size: 11px; color: var(--text-dim);">
        <span class="ready-dot"></span> Round 25 ready
      </div>
    </div>
  </div>

  <div class="output-panel">
    <div class="panel-header">
        <span>// OUTPUT STREAM</span>
        <i class="fa-solid fa-trash" style="margin-left: auto; cursor: pointer;" onclick="clearLog()"></i>
    </div>
    <div id="log-stream" class="output-content">
      <div class="log-line">
        <span class="status-tag">[..]</span>
        <span class="timestamp">00:00:00</span>
        <span class="msg-blue">Waiting for target URL...</span>
      </div>
    </div>
  </div>
</div>

<script>
  // Particles Background
  particlesJS("particles-js", {
    "particles": {
      "number": { "value": 60 },
      "color": { "value": "#00ff88" },
      "shape": { "type": "circle" },
      "opacity": { "value": 0.2 },
      "size": { "value": 1 },
      "line_linked": { "enable": true, "distance": 150, "color": "#00ff88", "opacity": 0.1 },
      "move": { "enable": true, "speed": 1 }
    }
  });

  const SHEETDB_URL = "https://sheetdb.io/api/v1/z0du4t0recg6p";

  function getTime() {
    return new Date().toLocaleTimeString('en-GB');
  }

  function writeLog(tag, msg, style = "") {
    const stream = document.getElementById('log-stream');
    const line = document.createElement('div');
    line.className = 'log-line';
    line.innerHTML = `
      <span class="status-tag">${tag}</span>
      <span class="timestamp">${getTime()}</span>
      <span class="${style}">${msg}</span>
    `;
    stream.appendChild(line);
    stream.scrollTop = stream.scrollHeight;
  }

  function clearLog() {
    document.getElementById('log-stream').innerHTML = '';
    writeLog("[..]", "Log cleared.", "msg-blue");
  }

  async function startEngine() {
    const url = document.getElementById('target-url').value;
    const delay = parseInt(document.getElementById('delay').value);

    if (!url.includes("ioe.vn")) {
      writeLog("[ER]", "INVALID TARGET URL", "msg-red");
      return;
    }

    writeLog("[..]", "Processing...", "msg-blue");
    
    try {
      // Dùng proxy AllOrigins để lách luật CORS
      const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
      if (!res.ok) throw new Error();
      const data = await res.json();
      
      const parser = new DOMParser();
      const doc = parser.parseFromString(data.contents, "text/html");

      // Lấy tên người chơi và vòng thi
      const user = doc.querySelector('.user-name')?.innerText || "Player_" + Math.random().toString(36).substring(7);
      const round = doc.title.split('-')[0] || "Round 0";

      writeLog("[OK]", `IOE: ${user} | ${round}`, "msg-green");
      writeLog("[..]", "Extracting questions...", "msg-blue");

      // Giả lập quét 10 câu hỏi như trong ảnh
      setTimeout(() => {
        writeLog("[..]", "10 questions detected", "msg-white");
        for(let i=1; i<=3; i++) {
            writeLog("[..]", `Q${i}: Analyzing content... -> SUCCESS`, "msg-blue");
        }

        let countdown = delay;
        const timer = setInterval(() => {
          writeLog("[~]", `Waiting to submit... (${countdown}s)`, "msg-blue");
          countdown--;
          if (countdown < 0) {
            clearInterval(timer);
            completeProcess(user, round, url);
          }
        }, 1000);
      }, 1500);

    } catch (e) {
      writeLog("[ER]", "CONNECTION FAILED! PLEASE CHECK LINK OR PROXY", "msg-red");
      writeLog("[..]", "Trying to reconnect in 3s...", "msg-red");
    }
  }

  async function completeProcess(name, round, link) {
    writeLog("[..]", "Submitting...", "msg-blue");
    try {
      await fetch(SHEETDB_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          data: [{
            question: name,
            answer: link,
            type: round,
            grade: "REAL-ENGINE",
            note: new Date().toLocaleString()
          }]
        })
      });
      writeLog("[OK]", "Completed: 100/100 (100%)", "msg-green");
    } catch (err) {
      writeLog("[ER]", "DATABASE SYNC FAILED", "msg-red");
    }
  }
</script>
</body>
</html>
